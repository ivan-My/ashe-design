name: CI

on:
    push:
        branches:
            - dev

    pull_request:
        branches:
            - dev

    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Install pnpm
              run: corepack enable

            - uses: actions/setup-node@v4
              with:
                  node-version: '18'
                  cache: 'pnpm'

            - name: Install dependencies
              run: pnpm install

            - name: Build ashe-design
              run: npm run build

            - name: Build ashe-design Demo
              run: npm run build:site

            - name: Upload files to server
              uses: appleboy/scp-action@master
              with:
                  host: ${{ secrets.SERVER_SSH_HOST }}
                  username: ${{ secrets.SERVER_SSH_USER }}
                  key: ${{ secrets.SERVER_SSH_KEY }} # 本地.ssh文件下的私钥id_rsa，存在secrets中
                  source: './html'
                  target: ${{ secrets.SERVER_SSH_TARGET }}

