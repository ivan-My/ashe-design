name: CI

on:
    push:
        branches:
            - dev

    pull_request:
        branches:
            - dev

    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Install pnpm
              run: corepack enable

            - uses: actions/setup-node@v4
              with:
                  node-version: '18'
                  cache: 'pnpm'

            - name: Install dependencies
              run: pnpm install

            - name: Build ashe-design
              run: npm run build

            - name: Build ashe-design Demo
              run: npm run build:site


            - name: Upload files to server
              uses: appleboy/scp-action@master
              with:
                  # 服务器域名
                  host: ${{ secrets.SERVER_SSH_HOST }}
                  # 服务器用户名
                  username: ${{ secrets.SERVER_SSH_USER }}
                  # 服务器密码
                  password: ${{ secrets.SERVER_PASSWORD }}
                  # 服务器端口
                  port: '22'
                  # 指定上传的文件目录(项目配置的打包目录名称)
                  source: './html/*'
                  # 指定上传服务器目录
                  target: ${{ secrets.SERVER_SSH_TARGET }}
                  # 解压时覆盖现有文件
                  overwrite: true
                  # 删除指定数量的前导路径元素
                  strip_components: 1


